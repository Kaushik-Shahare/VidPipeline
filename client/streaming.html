<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>HLS vs DASH Video Comparison</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 20px;
      }
      .video-row {
        display: flex;
        gap: 20px;
        margin-bottom: 50px;
      }
      .video-card {
        flex: 1;
      }
      video {
        width: 100%;
        height: auto;
        display: block;
        margin-top: 10px;
      }
      h2 {
        margin-bottom: 10px;
      }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <script src="https://cdn.dashjs.org/latest/dash.all.min.js"></script>
  </head>
  <body>
    <h1>HLS vs DASH Comparison</h1>
    <div id="videoList"></div>

    <script>
      const BACKEND_URL = "http://localhost:8000"; // FastAPI backend

      async function fetchVideos() {
        try {
          const resp = await fetch(`${BACKEND_URL}/videos`);
          const videos = await resp.json();
          const container = document.getElementById("videoList");

          if (!videos.length) {
            container.innerHTML = "<p>No videos uploaded yet.</p>";
            return;
          }

          videos.forEach((video) => {
            const row = document.createElement("div");
            row.className = "video-row";

            // HLS Player
            const hlsCard = document.createElement("div");
            hlsCard.className = "video-card";
            const hlsTitle = document.createElement("h2");
            hlsTitle.innerText = video.title + " (HLS)";
            const hlsVideo = document.createElement("video");
            hlsVideo.controls = true;

            if (video.hls_url) {
              const hlsSrc = `${BACKEND_URL}${video.hls_url}`;
              if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(hlsSrc);
                hls.attachMedia(hlsVideo);
              } else if (
                hlsVideo.canPlayType("application/vnd.apple.mpegurl")
              ) {
                hlsVideo.src = hlsSrc;
              }
            }

            hlsCard.appendChild(hlsTitle);
            hlsCard.appendChild(hlsVideo);

            // DASH Player
            const dashCard = document.createElement("div");
            dashCard.className = "video-card";
            const dashTitle = document.createElement("h2");
            dashTitle.innerText = video.title + " (DASH)";
            const dashVideo = document.createElement("video");
            dashVideo.controls = true;

            if (video.dash_url) {
              const player = dashjs.MediaPlayer().create();
              player.initialize(
                dashVideo,
                `${BACKEND_URL}${video.dash_url}`,
                true,
              );
            }

            dashCard.appendChild(dashTitle);
            dashCard.appendChild(dashVideo);

            // Append both cards side by side
            row.appendChild(hlsCard);
            row.appendChild(dashCard);
            container.appendChild(row);
          });
        } catch (err) {
          console.error("Failed to fetch videos:", err);
          document.getElementById("videoList").innerText =
            "Failed to load videos.";
        }
      }

      fetchVideos();
    </script>
  </body>
</html>
